<?xml version="1.0" encoding= "UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
 
<mapper namespace="objectDAO">

    <insert id="insertObject" parameterType="java.util.HashMap" >
      <selectKey resultType="string" keyProperty="objtNo" order="BEFORE">
        SELECT  ifnull (MAX(objtNo)+1,1) from saleobject       
      </selectKey>
    <![CDATA[
        INSERT into saleobject
				  ( objtNo
				  , objtTp
				  , objtNm
				  , custNm
				  , custTel1
				  , custTel2
				  , custTel3
				  , buildNm
				  , businessNm
				  , area
				  , realArea
				  , saleTp
				  , bargainAmt 
				  , depositAmt 
				  , monthlyAmt 
				  , dong
				  , floor
				  , directionTp
				  , dueDt
				  , roomCnt
				  , bathCnt
				  , ondolYn 
				  , availableTp
				  , availableDt 
				  , conditionTp
				  , memo
				  , activeTp
				  , publicYn
				  , advertiseYn
				  , parcelArea
				  , rightAmt 
				  , manageAmt 
				  , interiorYn 
				  , surtaxYn
				  , parcelAmt 
				  , premiumAmt
				  
				  )
        	values ( 
        			#{objtNo}
        		  , #{objtTp}
				  , #{objtNm}
				  , #{custNm}
				  , CASE WHEN #{custTel1} = '' THEN NULL ELSE #{custTel1} END
				  , CASE WHEN #{custTel2} = '' THEN NULL ELSE #{custTel2} END
				  , CASE WHEN #{custTel3} = '' THEN NULL ELSE #{custTel3} END
				  , #{buildNm}
				  , #{businessNm}
				  , CASE WHEN #{area} = '' THEN 0 ELSE #{area} END
				  , CASE WHEN #{realArea} = '' THEN 0 ELSE #{realArea} END
				  , #{saleTp} 
				  , CASE WHEN #{bargainAmt} = '' THEN 0 ELSE #{bargainAmt} END 
				  , CASE WHEN #{depositAmt} = '' THEN 0 ELSE #{depositAmt} END  
				  , CASE WHEN #{monthlyAmt} = '' THEN 0 ELSE #{monthlyAmt} END  
				  , #{dong}
				  , CASE WHEN #{floor} = '' THEN NULL ELSE #{floor} END 
				  , #{directionTp}
				  , #{dueDt}
				  , CASE WHEN #{roomCnt} = '' THEN NULL ELSE #{roomCnt} END 
				  , CASE WHEN #{bathCnt} = '' THEN NULL ELSE #{bathCnt} END 
				  , #{ondolYn} 
				  , #{availableTp}
				  , CASE WHEN #{availableDt} = '' THEN NULL ELSE #{availableDt} END
				  , #{conditionTp}
				  , #{memo}
				  , #{activeTp}
				  , CASE WHEN #{advertiseYn} = 'Y' THEN 'Y' ELSE 'N' END
				  , CASE WHEN #{publicYn} = 'Y' THEN 'Y' ELSE 'N' END
				  , CASE WHEN #{parcelArea} = '' THEN 0 ELSE #{parcelArea} END
				  , CASE WHEN #{rightAmt} = '' THEN 0 ELSE #{rightAmt} END  
				  , CASE WHEN #{manageAmt} = '' THEN 0 ELSE #{manageAmt} END  
				  , CASE WHEN #{interiorYn} = '' THEN NULL ELSE #{interiorYn} END 
				  , CASE WHEN #{surtaxYn} = '' THEN NULL ELSE #{surtaxYn} END 
				  , CASE WHEN #{parcelAmt} = '' THEN 0 ELSE #{parcelAmt} END 
				  , CASE WHEN #{premiumAmt} = '' THEN 0 ELSE #{premiumAmt} END 
				  
        	);
       ]]>
		
    </insert>
    
    <select id="selectObjectCnt" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT a.objtTp, a.saleTp, ifnull(cntSaleTp, 0) cntSaleTp
	FROM
		(
		SELECT a.commCd objtTp, b.commCd saleTp
		  FROM commCd a, commCd b
		 where a.groupCd = 'OT'
		   and b.groupCd = 'ST'
		) AS A
	LEFT OUTER JOIN 
	   (SELECT objtTp, saleTp, count(saleTp) cntSaleTp
		  FROM saleobject
		  GROUP BY objtTp, saleTp
		) AS B
	 ON A.objtTp = B.objtTp
	 AND A.saleTp = B.saleTp
	ORDER BY a.objtTp, a.saleTp
    </select>
    
	<select id="selectObjectList" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT DATE_FORMAT(firstRegDt, '%Y-%m-%d') as firstRegDt
	     , objtNo
	     , objtTp
	     , objtNm
	     , area
	     , realArea
	     , dong
	     , floor
	     , directionTp
	     , (select commNm from commcd where commCd = directionTp ) directionTpNm
	     , bargainAmt
	     , concat(depositAmt , '/' , monthlyAmt) depositAmt
	     , rightAmt
	     , ifnull (ondolYn, 'N') ondolYn
	     , conditionTp 
	     , (select commNm from commcd where commCd = conditionTp ) conditionTpNm
	     , firstRegUser
	     , activeTp
	     , (select commNm from commcd where commCd = activeTp ) activeTpNm
	     , surtaxYn
	     , advertiseYn
	     , publicYn
	     , DATE_FORMAT(availableDt, '%Y-%m-%d') as availableDt
	 	 , parcelAmt
	 	 ,  premiumAmt
	     , concat((CASE WHEN advertiseYn = 'Y' THEN '광고' END) , (CASE WHEN advertiseYn = 'Y' THEN ','END)  , (CASE WHEN publicYn = 'Y' THEN '공동' END)) etc
	     , firstRegUser firstRegNm
	  FROM estate.saleobject
	 WHERE objtTp = #{objtTp}
	   AND saleTp = #{saleTp}	
	</select>
	
	<select id="selectObjectInfo" parameterType="java.util.HashMap" resultType="java.util.HashMap">
	SELECT DATE_FORMAT(firstRegDt, '%Y-%m-%d') as firstRegDt
	     , objtNo
	     , objtTp
	     , objtNm
	     , area
	     , realArea
	     , dong
	     , floor
	     , directionTp
	     , (select commNm from commcd where commCd = directionTp ) directionTpNm
	     , bargainAmt
	     , concat(depositAmt , '/' , monthlyAmt) depositAmt
	     , rightAmt
	     , ifnull (ondolYn, 'N') ondolYn
	     , conditionTp 
	     , (select commNm from commcd where commCd = conditionTp ) conditionTpNm
	     , firstRegUser
	     , activeTp
	     , (select commNm from commcd where commCd = activeTp ) activeTpNm
	     , surtaxYn
	     , advertiseYn
	     , publicYn
	     , DATE_FORMAT(availableDt, '%Y-%m-%d') as availableDt
	 	 , parcelAmt
	 	 ,  premiumAmt
	     , concat((CASE WHEN advertiseYn = 'Y' THEN '광고' END) , (CASE WHEN advertiseYn = 'Y' THEN ','END)  , (CASE WHEN publicYn = 'Y' THEN '공동' END)) etc
	     , firstRegUser firstRegNm
	  FROM estate.saleobject
	 WHERE objtNo = #{objtNo}
	   AND objtTp = #{objtTp}
	</select>
	
	
	
	
</mapper>